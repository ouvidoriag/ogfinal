<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Impressão - Informações da Secretaria</title>
    <!-- Google Fonts - Rajdhani (mesma fonte do painel de login) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      @page {
        size: A4 portrait;
        margin: 20mm;
      }

      * {
        box-sizing: border-box;
        font-family: 'Rajdhani', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }

      body {
        margin: 0;
        padding: 0;
        background: #ffffff;
        color: #111827;
      }

      .page {
        width: 100%;
        min-height: 100%;
        display: flex;
        flex-direction: column;
      }

      header {
        text-align: center;
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 2px solid #0f766e;
      }

      header h1 {
        font-size: 20px;
        margin: 0;
        color: #0f766e;
      }

      header p {
        margin: 4px 0 0;
        font-size: 12px;
        color: #4b5563;
      }

      .content {
        margin-top: 8px;
        font-size: 13px;
      }

      .field-group {
        margin-bottom: 8px;
      }

      .label {
        font-weight: 600;
        color: #374151;
        display: block;
        margin-bottom: 2px;
        font-size: 11px;
        letter-spacing: 0.02em;
        text-transform: uppercase;
      }

      .value {
        padding: 6px 8px;
        border-radius: 4px;
        border: 1px solid #e5e7eb;
        background: #f9fafb;
        min-height: 20px;
      }

      .muted {
        color: #9ca3af;
      }

      .row {
        display: flex;
        gap: 12px;
      }

      .col {
        flex: 1 1 0;
      }

      footer {
        margin-top: 24px;
        font-size: 10px;
        color: #9ca3af;
        display: flex;
        justify-content: space-between;
      }

      @media print {
        .no-print {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <h1>Informações da Secretaria</h1>
        <p>Ouvidoria – Duque de Caxias</p>
      </header>

      <div class="content" id="content">
        <p>Carregando dados da secretaria...</p>
      </div>

      <footer>
        <span id="generatedAt"></span>
        <span>Dashboard Ouvidoria Duque de Caxias</span>
      </footer>
    </div>

    <script>
      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      function formatValue(value) {
        if (!value) {
          return '<span class="muted">—</span>';
        }
        return String(value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
      }

      async function loadSecretaria() {
        const id = getQueryParam('id');
        const content = document.getElementById('content');
        const generatedAt = document.getElementById('generatedAt');

        const now = new Date();
        generatedAt.textContent = 'Gerado em: ' + now.toLocaleString('pt-BR');

        if (!id) {
          content.innerHTML = '<p class="muted">Nenhuma secretaria selecionada.</p>';
          return;
        }

        try {
          const response = await fetch('/api/secretarias-info/' + encodeURIComponent(id), {
            credentials: 'include',
          });

          if (!response.ok) {
            throw new Error('Erro ao carregar dados da secretaria');
          }

          const s = await response.json();

          content.innerHTML = `
            <div class="field-group">
              <span class="label">Secretaria / Órgão</span>
              <div class="value">${formatValue(s.name || s.acronym)}</div>
            </div>

            <div class="row">
              <div class="field-group col">
                <span class="label">Sigla</span>
                <div class="value">${formatValue(s.acronym)}</div>
              </div>
              <div class="field-group col">
                <span class="label">Distrito</span>
                <div class="value">${formatValue(s.district)}</div>
              </div>
            </div>

            <div class="row">
              <div class="field-group col">
                <span class="label">Email Principal</span>
                <div class="value">${formatValue(s.email)}</div>
              </div>
              <div class="field-group col">
                <span class="label">Email Alternativo</span>
                <div class="value">${formatValue(s.alternateEmail)}</div>
              </div>
            </div>

            <div class="row">
              <div class="field-group col">
                <span class="label">Telefone</span>
                <div class="value">${formatValue(s.phone)}</div>
              </div>
              <div class="field-group col">
                <span class="label">Telefone Alternativo</span>
                <div class="value">${formatValue(s.phoneAlt)}</div>
              </div>
            </div>

            <div class="field-group">
              <span class="label">Endereço</span>
              <div class="value">${formatValue(s.address)}</div>
            </div>

            <div class="row">
              <div class="field-group col">
                <span class="label">Bairro</span>
                <div class="value">${formatValue(s.bairro)}</div>
              </div>
            </div>

            <div class="field-group">
              <span class="label">Observações</span>
              <div class="value">${formatValue(s.notes)}</div>
            </div>
          `;

          // Pequeno delay para garantir renderização antes da impressão
          setTimeout(() => {
            window.print();
          }, 500);
        } catch (error) {
          content.innerHTML = '<p class="muted">Erro ao carregar dados da secretaria.</p>';
          // Mesmo em erro, permitir impressão da página com a mensagem
          setTimeout(() => {
            window.print();
          }, 500);
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadSecretaria);
      } else {
        loadSecretaria();
      }
    </script>
  </body>
  </html>


